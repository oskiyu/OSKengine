\hypertarget{_pbr_deferred_render_system_8cpp_source}{}\doxysection{Pbr\+Deferred\+Render\+System.\+cpp}
\label{_pbr_deferred_render_system_8cpp_source}\index{OSKengine2/PbrDeferredRenderSystem.cpp@{OSKengine2/PbrDeferredRenderSystem.cpp}}
\mbox{\hyperlink{_pbr_deferred_render_system_8cpp}{Ir a la documentaciÃ³n de este archivo.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_pbr_deferred_render_system_8h}{PbrDeferredRenderSystem.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00003}00003 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_o_s_kengine_8h}{OSKengine.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00004}00004 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_entity_component_system_8h}{EntityComponentSystem.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00005}00005 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_transform3_d_8h}{Transform3D.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00006}00006 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_model_component3_d_8h}{ModelComponent3D.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00007}00007 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_i_command_list_8h}{ICommandList.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00008}00008 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_i_renderer_8h}{IRenderer.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00009}00009 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_gpu_image_usage_8h}{GpuImageUsage.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00010}00010 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_gpu_image_dimensions_8h}{GpuImageDimensions.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00011}00011 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_gpu_memory_types_8h}{GpuMemoryTypes.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00012}00012 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_format_8h}{Format.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00013}00013 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_material_instance_8h}{MaterialInstance.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00014}00014 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_material_8h}{Material.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00015}00015 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_material_layout_8h}{MaterialLayout.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00016}00016 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_model3_d_8h}{Model3D.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00017}00017 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_mesh3_d_8h}{Mesh3D.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00018}00018 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_viewport_8h}{Viewport.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00019}00019 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_window_8h}{Window.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00020}00020 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_gpu_image_layout_8h}{GpuImageLayout.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00021}00021 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00022}00022 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_camera_component3_d_8h}{CameraComponent3D.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00023}00023 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_irradiance_map_8h}{IrradianceMap.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00024}00024 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_push_const2_d_8h}{PushConst2D.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00025}00025 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_sprite_renderer_8h}{SpriteRenderer.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00027}00027 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespace_o_s_k}{OSK}};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00028}00028 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespace_o_s_k_1_1_e_c_s}{OSK::ECS}};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00029}00029 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespace_o_s_k_1_1_a_s_s_e_t_s}{OSK::ASSETS}};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00030}00030 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s}{OSK::GRAPHICS}};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00033}\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_abb4872dac6f01ec1c051c88d8ed851c5}{00033}} PbrDeferredRenderSystem::PbrDeferredRenderSystem() \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00034}00034     \textcolor{comment}{// Signature del sistema}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00035}00035     \mbox{\hyperlink{class_o_s_k_1_1_constexpr_bit_set}{Signature}} signature\{\};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00036}00036     signature.\mbox{\hyperlink{class_o_s_k_1_1_constexpr_bit_set_a2ed44d2a40faf6ff664947caf93846b4}{SetTrue}}(\mbox{\hyperlink{class_o_s_k_1_1_engine_a17fd2842c078b7ddb4aaa70cd04549ab}{Engine::GetEntityComponentSystem}}()-\/>GetComponentType<Transform3D>());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00037}00037     signature.SetTrue(\mbox{\hyperlink{class_o_s_k_1_1_engine_a17fd2842c078b7ddb4aaa70cd04549ab}{Engine::GetEntityComponentSystem}}()-\/>GetComponentType<ModelComponent3D>());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00038}00038     \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_system_ac9336e70706ab6ea24d9f5fe95955efd}{SetSignature}}(signature);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00039}00039 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00040}00040     \textcolor{comment}{// Mapa de sombras}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00041}00041     shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a0830a954dc3dfb5b404edc5e85ec6406}{Create}}(\{ 4096u \});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00042}00042 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00043}00043     \textcolor{comment}{// Directional light por defecto}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00044}00044     \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_vector3__t}{Vector3f}} direction = \mbox{\hyperlink{namespace_o_s_k_a5e479af2ede269150542d90384ce3ee2}{Vector3f}}(1.0f, -\/3.f, 0.0f).\mbox{\hyperlink{class_o_s_k_1_1_vector3__t_aef1702c4230df139c7f0e28cd27bc4a6}{GetNormalized}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00045}00045     dirLight.\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_directional_light_afa382eaf7c25cc83c5ed5ded9c97ebcd}{directionAndIntensity}} = \mbox{\hyperlink{namespace_o_s_k_a98c42bf0a7665f299a3a66c8d4cdcdc2}{Vector4f}}(direction.\mbox{\hyperlink{class_o_s_k_1_1_vector3__t_a9dd92e8b519b62ce53eb71f58eba6d50}{X}}, direction.\mbox{\hyperlink{class_o_s_k_1_1_vector3__t_afb19e7227d4047f7a666c03cea2b1658}{Y}}, direction.\mbox{\hyperlink{class_o_s_k_1_1_vector3__t_a50505b9a44529ae5aff66a956214549b}{Z}}, 1.2f);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00046}00046     dirLight.\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_directional_light_a4c590d24d32a6ef8cffd96c9a6a35826}{color}} = \mbox{\hyperlink{class_o_s_k_1_1_color}{Color}}(253 / 255.f, 253 / 255.f, 225 / 255.f);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00047}00047 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00049}00049     \textcolor{comment}{// Material del resolve final.}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00050}00050     resolveMaterial = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_a15a2d271ad61c59ce4414dbdf016d277}{GetMaterialSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_system_ad39c519e3a5f58cc2a7622ba9b39687a}{LoadMaterial}}(\textcolor{stringliteral}{"{}Resources/PbrMaterials/deferred\_resolve.json"{}});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00051}00051     resolveMaterialInstance = resolveMaterial-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_acf1dacea3b45a53ca86d96e30af22af1}{CreateInstance}}().GetPointer();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00053}00053     \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_gpu_uniform_buffer}{IGpuUniformBuffer}}* \_cameraUbos[3]\{\};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00054}00054     \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_gpu_uniform_buffer}{IGpuUniformBuffer}}* \_dirLightUbos[3]\{\};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00055}00055     \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_gpu_uniform_buffer}{IGpuUniformBuffer}}* \_shadowsMatricesUbos[3]\{\};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00056}00056     \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image}{GpuImage}}* \_shadowsMaps[3]\{\};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00057}00057     \textcolor{keywordflow}{for} (\mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} i = 0; i < 3; i++) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00058}00058         cameraUbos[i] = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_acf03703bbb6f031f905612d86f104b38}{GetMemoryAllocator}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_gpu_memory_allocator_ac8beb74ff85ed07f8d96a60683ac0599}{CreateUniformBuffer}}(\textcolor{keyword}{sizeof}(glm::mat4) * 2 + \textcolor{keyword}{sizeof}(glm::vec4)).GetPointer();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00059}00059         \_cameraUbos[i] = cameraUbos[i].GetPointer();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00061}00061         dirLightUbos[i] = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_acf03703bbb6f031f905612d86f104b38}{GetMemoryAllocator}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_gpu_memory_allocator_ac8beb74ff85ed07f8d96a60683ac0599}{CreateUniformBuffer}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_directional_light}{DirectionalLight}})).GetPointer();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00062}00062         \_dirLightUbos[i] = dirLightUbos[i].GetPointer();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00064}00064         \_shadowsMatricesUbos[i] = shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a3623673ebffd02cd44830d38b5e52b95}{GetDirLightMatrixUniformBuffers}}()[i];}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00065}00065         \_shadowsMaps[i] = shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a3c867730c2810236e1983be4d0e2190c}{GetShadowImage}}(i);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00066}00066     \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00068}00068     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}})-\/>SetUniformBuffers(\textcolor{stringliteral}{"{}camera"{}}, \_cameraUbos);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00069}00069     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}})-\/>SetUniformBuffers(\textcolor{stringliteral}{"{}dirLight"{}}, \_dirLightUbos);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00070}00070     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}})-\/>SetUniformBuffers(\textcolor{stringliteral}{"{}dirLightShadowMat"{}}, \_shadowsMatricesUbos);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00071}00071     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}})-\/>SetGpuImages(\textcolor{stringliteral}{"{}dirLightShadowMap"{}}, \_shadowsMaps, SampledChannel::DEPTH, SampledArrayType::ARRAY);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00072}00072     }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00074}00074     \textcolor{comment}{// Material del renderizado del gbuffer.}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00075}00075     gbufferMaterial = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_a15a2d271ad61c59ce4414dbdf016d277}{GetMaterialSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_system_ad39c519e3a5f58cc2a7622ba9b39687a}{LoadMaterial}}(\textcolor{stringliteral}{"{}Resources/PbrMaterials/deferred\_gbuffer.json"{}});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00076}00076     animatedGbufferMaterial = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_a15a2d271ad61c59ce4414dbdf016d277}{GetMaterialSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_system_ad39c519e3a5f58cc2a7622ba9b39687a}{LoadMaterial}}(\textcolor{stringliteral}{"{}Resources/PbrMaterials/deferred\_gbuffer\_anim.json"{}});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00077}00077     globalGbufferMaterialInstance = gbufferMaterial-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_acf1dacea3b45a53ca86d96e30af22af1}{CreateInstance}}().GetPointer();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00078}00078 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00079}00079     globalGbufferMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}})-\/>SetUniformBuffers(\textcolor{stringliteral}{"{}camera"{}}, \_cameraUbos);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00080}00080     globalGbufferMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}})-\/>FlushUpdate();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00081}00081 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00082}00082 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00083}\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_a1ab3cd6d093fd8c7e5db00bc3f491ae1}{00083}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_a1ab3cd6d093fd8c7e5db00bc3f491ae1}{PbrDeferredRenderSystem::Initialize}}(\mbox{\hyperlink{namespace_o_s_k_1_1_e_c_s_a23d62d7bd6a58fd7f758079d87df6c71}{GameObjectIndex}} camera, \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_irradiance_map}{ASSETS::IrradianceMap}}\& irradianceMap) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00084}00084     cameraObject = camera;}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00086}00086     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}})-\/>SetUniformBuffer(\textcolor{stringliteral}{"{}camera2D"{}}, \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>GetRenderTargetsCamera().GetUniformBuffer());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00087}00087     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}})-\/>SetGpuImage(\textcolor{stringliteral}{"{}irradianceMap"{}}, irradianceMap.\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_irradiance_map_a1ccaa4464e037058aeabc27de7854f7a}{GetGpuImage}}());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00088}00088     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}})-\/>FlushUpdate();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00090}00090     shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a2049f04835be03e41411a54457933d50}{SetSceneCamera}}(camera);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00091}00091 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00092}00092     hasBeenInitialized = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00093}00093 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00095}00095 \textcolor{keywordtype}{void} PbrDeferredRenderSystem::UpdateResolveMaterial() \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00096}00096     \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image}{GpuImage}}* images[3]\{\};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00097}00097     \textcolor{keywordflow}{for} (\mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} i = 0; i < 3; i++) images[i] = gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_a05a99fdb142018512bc2a466b8b3c705}{GetTargetImages}}(i)[\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_af8b718e17ce1154a0fd0f033f1e06858}{GBUFFER\_POSITION\_TARGET\_INDEX}}];}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00098}00098     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}gbuffer"{}})-\/>SetGpuImages(\textcolor{stringliteral}{"{}positionTexture"{}}, images);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00100}00100     \textcolor{keywordflow}{for} (\mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} i = 0; i < 3; i++) images[i] = gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_a05a99fdb142018512bc2a466b8b3c705}{GetTargetImages}}(i)[\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_aeee6756b04e3babeb0dbc62ec44bcd43}{GBUFFER\_COLOR\_TARGET\_INDEX}}];}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00101}00101     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}gbuffer"{}})-\/>SetGpuImages(\textcolor{stringliteral}{"{}colorTexture"{}}, images);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00102}00102 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00103}00103     \textcolor{keywordflow}{for} (\mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} i = 0; i < 3; i++) images[i] = gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_a05a99fdb142018512bc2a466b8b3c705}{GetTargetImages}}(i)[\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_a6c6c50f55a37a05a561d6ed6ad10cd17}{GBUFFER\_NORMAL\_TARGET\_INDEX}}];}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00104}00104     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}gbuffer"{}})-\/>SetGpuImages(\textcolor{stringliteral}{"{}normalTexture"{}}, images);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00105}00105 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00106}00106     resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}gbuffer"{}})-\/>FlushUpdate();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00107}00107 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00108}00108 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00109}\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_a89c47dfc0ce46e0af13ffea6128e9c8d}{00109}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_a89c47dfc0ce46e0af13ffea6128e9c8d}{PbrDeferredRenderSystem::CreateTargetImage}}(\textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_vector2__t}{Vector2ui}}\& size) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00110}00110     \textcolor{comment}{// GBuffer.}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00111}00111     gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_a2762dc66547722dc7742657d52f000bb}{Create}}(size, Format::RGBA32\_SFLOAT, Format::D32S8\_SFLOAT\_SUINT);  \textcolor{comment}{// POSITION}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00112}00112     gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_ad8040f68b08e665d6c6f14f6367253ef}{AddColorTarget}}(Format::RGBA8\_SRGB); \textcolor{comment}{// COLOR}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00113}00113     gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_ad8040f68b08e665d6c6f14f6367253ef}{AddColorTarget}}(Format::RGBA32\_SFLOAT); \textcolor{comment}{// NORMAL}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00114}00114     gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_af79cef3ae998b47fd109d86c3c19ee35}{SetName}}(\textcolor{stringliteral}{"{}GBuffer"{}});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00115}00115 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00116}00116     \textcolor{comment}{// Imagen final.}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00117}00117     \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_render_system_a8e9d568865c3d41fbec6afd49acb3cfa}{renderTarget}}.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_a2762dc66547722dc7742657d52f000bb}{Create}}(size, Format::RGBA32\_SFLOAT, Format::D32S8\_SFLOAT\_SUINT);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00118}00118     \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_render_system_a8e9d568865c3d41fbec6afd49acb3cfa}{renderTarget}}.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_af79cef3ae998b47fd109d86c3c19ee35}{SetName}}(\textcolor{stringliteral}{"{}Deferred Target"{}});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00119}00119 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00120}00120     UpdateResolveMaterial();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00121}00121 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00122}00122 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00123}\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_aaece8432a7dd1a62b67b1c76b707c211}{00123}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_aaece8432a7dd1a62b67b1c76b707c211}{PbrDeferredRenderSystem::Resize}}(\textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_vector2__t}{Vector2ui}}\& windowSize) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00124}00124     gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_ac9f5d87b43a7e692631a8269f4c97f2d}{Resize}}(windowSize);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00125}00125 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00126}00126     \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_render_system_aec037cb8c46f11305e3c68a615a8ab4c}{IRenderSystem::Resize}}(windowSize);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00127}00127 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00128}00128     UpdateResolveMaterial();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00129}00129 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00130}00130 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00131}\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_a85151789fcc029575e6f6800e8ba68aa}{00131}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_a85151789fcc029575e6f6800e8ba68aa}{PbrDeferredRenderSystem::Render}}(\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list}{ICommandList}}* commandList) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00132}00132     \textcolor{keyword}{const} \mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} currentIndex = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_a4a779e3af14025ec16d8a0c0a6cf0fe5}{GetCurrentCommandListIndex}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00133}00133 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00134}00134     \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_camera_component3_d}{CameraComponent3D}}\& camera = \mbox{\hyperlink{class_o_s_k_1_1_engine_a17fd2842c078b7ddb4aaa70cd04549ab}{Engine::GetEntityComponentSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_entity_component_system_ab543c5c91b9b319ed21a01da96ea06d9}{GetComponent}}<\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_camera_component3_d}{CameraComponent3D}}>(cameraObject);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00135}00135     \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_transform3_d}{Transform3D}}\& cameraTransform = \mbox{\hyperlink{class_o_s_k_1_1_engine_a17fd2842c078b7ddb4aaa70cd04549ab}{Engine::GetEntityComponentSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_entity_component_system_ab543c5c91b9b319ed21a01da96ea06d9}{GetComponent}}<\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_transform3_d}{Transform3D}}>(cameraObject);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00136}00136 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00137}00137     cameraUbos[currentIndex]-\/>MapMemory();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00138}00138     cameraUbos[currentIndex]-\/>Write(camera.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_camera_component3_d_a68079a946e3c8d14718ef8d0f560b9c0}{GetProjectionMatrix}}());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00139}00139     cameraUbos[currentIndex]-\/>Write(camera.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_camera_component3_d_a5cc4bc7e2d2d8c23c93b13096970acdb}{GetViewMatrix}}(cameraTransform));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00140}00140     cameraUbos[currentIndex]-\/>Write(cameraTransform.GetPosition());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00141}00141     cameraUbos[currentIndex]-\/>Unmap();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00142}00142 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00143}00143     dirLightUbos[currentIndex]-\/>MapMemory();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00144}00144     dirLightUbos[currentIndex]-\/>Write(dirLight);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00145}00145     dirLightUbos[currentIndex]-\/>Unmap();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00146}00146 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00147}00147     shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_ab750efcb37e8e0e58084096c18d1d0d6}{SetDirectionalLight}}(dirLight);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00148}00148 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00149}00149     GenerateShadows(commandList);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00150}00150     RenderGBuffer(commandList);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00151}00151     Resolve(commandList);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00152}00152 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00153}00153 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00154}00154 \textcolor{keywordtype}{void} PbrDeferredRenderSystem::GenerateShadows(\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list}{ICommandList}}* commandList) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00155}00155     \textcolor{keyword}{const} \mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} currentFrameIndex = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_a4a779e3af14025ec16d8a0c0a6cf0fe5}{GetCurrentCommandListIndex}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00156}00156     \textcolor{keyword}{const} \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_viewport}{Viewport}} viewport\{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00157}00157         .\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_viewport_a3a44365634cd80baebfa85c16d3339d9}{rectangle}} = \{ 0u, 0u, shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_aa9abc4993f6720c28ee54faa2df13cac}{GetColorImage}}(0)-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_a244ebc8ce3ae3095698ea0c3eaba58fc}{GetSize}}().\mbox{\hyperlink{class_o_s_k_1_1_vector3__t_a9dd92e8b519b62ce53eb71f58eba6d50}{X}}, shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_aa9abc4993f6720c28ee54faa2df13cac}{GetColorImage}}(0)-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_a244ebc8ce3ae3095698ea0c3eaba58fc}{GetSize}}().\mbox{\hyperlink{class_o_s_k_1_1_vector3__t_afb19e7227d4047f7a666c03cea2b1658}{Y}} \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00158}00158     \};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00159}00159 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00160}00160     commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a4f744548e824c36b684f4d35bd1b90b2}{SetGpuImageBarrier}}(shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a3c867730c2810236e1983be4d0e2190c}{GetShadowImage}}(currentFrameIndex), GpuImageLayout::DEPTH\_STENCIL\_TARGET,}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00161}00161         \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::FRAGMENT\_SHADER, GpuBarrierAccessStage::SHADER\_READ), \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::DEPTH\_STENCIL\_START, GpuBarrierAccessStage::DEPTH\_STENCIL\_READ | GpuBarrierAccessStage::DEPTH\_STENCIL\_WRITE),}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00162}00162         \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_barrier_info}{GpuImageBarrierInfo}}\{ .\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_barrier_info_a89f637c4de7944fc1228348171b23830}{baseLayer}} = 0, .numLayers = shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a19ef749dc3d51d127b5191dfcbb09ca2}{GetNumCascades}}(), .baseMipLevel = 0, .numMipLevels = \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_af4ec621c557d492c7de3493e2b2bd1a9}{ALL\_MIP\_LEVELS}}, .channel = SampledChannel::DEPTH | SampledChannel::STENCIL \});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00163}00163 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00164}00164     commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_ad7cd8a020a86d10e75f1b0241e41cc37}{SetViewport}}(viewport);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00165}00165     commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_ad7246c4be8141d70827ee91c1686144e}{SetScissor}}(viewport.rectangle);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00166}00166 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00167}00167     \textcolor{keywordflow}{for} (\mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} i = 0; i < shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a19ef749dc3d51d127b5191dfcbb09ca2}{GetNumCascades}}(); i++) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00168}00168         \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_pass_image_info}{RenderPassImageInfo}} colorInfo\{\};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00169}00169         colorInfo.\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_pass_image_info_a870b6478e66f3abf1aa43f0cf7771368}{arrayLevel}} = i;}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00170}00170         colorInfo.targetImage = shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_aa9abc4993f6720c28ee54faa2df13cac}{GetColorImage}}(currentFrameIndex);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00172}00172         \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_pass_image_info}{RenderPassImageInfo}} depthInfo\{\};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00173}00173         depthInfo.\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_pass_image_info_a870b6478e66f3abf1aa43f0cf7771368}{arrayLevel}} = i;}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00174}00174         depthInfo.targetImage = shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a3c867730c2810236e1983be4d0e2190c}{GetShadowImage}}(currentFrameIndex);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00175}00175 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00176}00176         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_ae3d1fda12c227f4b1782a16c2dca7f5c}{BeginGraphicsRenderpass}}(\{ colorInfo \}, depthInfo, \{ 1.0f, 1.0f, 1.0f, 1.0f \});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00177}00177 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00178}00178         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aced1453da2f79b5e435df27c330ab8d1}{BindMaterial}}(shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_ac65819749ffb51ef5ce805ac35b7910d}{GetShadowsMaterial}}(\mbox{\hyperlink{namespace_o_s_k_1_1_a_s_s_e_t_s_a192866f841033401ce3c83efcaf81027a9ae070d34a7ef3af54b1fd95652c0e18}{ASSETS::ModelType::STATIC\_MESH}}));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00179}00179         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aebccacb95627e6c8c9da33367ca14368}{BindMaterialSlot}}(shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_ad7263c5e330f9148ba87ebff3aae13b3}{GetShadowsMaterialInstance}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_instance_a0cc12aae6dc313b4c4f24abe461b5f04}{GetSlot}}(\textcolor{stringliteral}{"{}global"{}}));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00180}00180 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00181}00181         ShadowsRenderLoop(ModelType::STATIC\_MESH, commandList, i);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00182}00182         }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00183}00183         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aced1453da2f79b5e435df27c330ab8d1}{BindMaterial}}(shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_ac65819749ffb51ef5ce805ac35b7910d}{GetShadowsMaterial}}(ModelType::ANIMATED\_MODEL));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00184}00184         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aebccacb95627e6c8c9da33367ca14368}{BindMaterialSlot}}(shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_ad7263c5e330f9148ba87ebff3aae13b3}{GetShadowsMaterialInstance}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_instance_a0cc12aae6dc313b4c4f24abe461b5f04}{GetSlot}}(\textcolor{stringliteral}{"{}global"{}}));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00185}00185         ShadowsRenderLoop(ModelType::ANIMATED\_MODEL, commandList, i);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00186}00186 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00187}00187         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a27c970b0c75c78d08fa173eb3b875eb1}{EndGraphicsRenderpass}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00188}00188     \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00189}00189 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00190}00190     commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a4f744548e824c36b684f4d35bd1b90b2}{SetGpuImageBarrier}}(shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a3c867730c2810236e1983be4d0e2190c}{GetShadowImage}}(currentFrameIndex), GpuImageLayout::SHADER\_READ\_ONLY,}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00191}00191         \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::DEPTH\_STENCIL\_END, GpuBarrierAccessStage::DEPTH\_STENCIL\_READ | GpuBarrierAccessStage::DEPTH\_STENCIL\_WRITE), \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::FRAGMENT\_SHADER, GpuBarrierAccessStage::SHADER\_READ),}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00192}00192         \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_barrier_info}{GpuImageBarrierInfo}}\{ .\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_barrier_info_a89f637c4de7944fc1228348171b23830}{baseLayer}} = 0, .numLayers = shadowMap.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_shadow_map_a19ef749dc3d51d127b5191dfcbb09ca2}{GetNumCascades}}(), .baseMipLevel = 0, .numMipLevels = \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_af4ec621c557d492c7de3493e2b2bd1a9}{ALL\_MIP\_LEVELS}}, .channel = SampledChannel::DEPTH | SampledChannel::STENCIL \});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00193}00193 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00194}00194 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00195}00195 \textcolor{keywordtype}{void} PbrDeferredRenderSystem::GBufferRenderLoop(\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list}{GRAPHICS::ICommandList}}* commandList, \mbox{\hyperlink{namespace_o_s_k_1_1_a_s_s_e_t_s_a192866f841033401ce3c83efcaf81027}{ASSETS::ModelType}} modelType) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00196}00196     \mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_gpu_vertex_buffer}{IGpuVertexBuffer}}* previousVertexBuffer = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00197}00197     \mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_gpu_index_buffer}{IGpuIndexBuffer}}* previousIndexBuffer = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00198}00198     }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00199}00199     \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespace_o_s_k_1_1_e_c_s_a23d62d7bd6a58fd7f758079d87df6c71}{GameObjectIndex}} obj : \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_system_ad3611590e6bde825b973c160d7a867d9}{GetObjects}}()) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00200}00200         \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d}{ModelComponent3D}}\& model = \mbox{\hyperlink{class_o_s_k_1_1_engine_a17fd2842c078b7ddb4aaa70cd04549ab}{Engine::GetEntityComponentSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_entity_component_system_ab543c5c91b9b319ed21a01da96ea06d9}{GetComponent}}<\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d}{ModelComponent3D}}>(obj);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00201}00201         \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_transform3_d}{Transform3D}}\& transform = \mbox{\hyperlink{class_o_s_k_1_1_engine_a17fd2842c078b7ddb4aaa70cd04549ab}{Engine::GetEntityComponentSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_entity_component_system_ab543c5c91b9b319ed21a01da96ea06d9}{GetComponent}}<\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_transform3_d}{Transform3D}}>(obj);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00202}00202 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00203}00203         \textcolor{keywordflow}{if} (modelType != model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a29273ffaa49b5726cf7b942268a93e84}{GetType}}())}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00204}00204             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00205}00205 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00206}00206         \textcolor{keywordflow}{if} (modelType == ModelType::STATIC\_MESH)}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00207}00207             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aced1453da2f79b5e435df27c330ab8d1}{BindMaterial}}(gbufferMaterial);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00208}00208         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00209}00209             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aced1453da2f79b5e435df27c330ab8d1}{BindMaterial}}(animatedGbufferMaterial);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00211}00211         \textcolor{comment}{// Actualizamos el modelo 3D, si es necesario.}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00212}00212         \textcolor{keywordflow}{if} (previousVertexBuffer != model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_ae71e7cb40f766ce9b5490b22971174ac}{GetVertexBuffer}}()) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00213}00213             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a5e41e7a449345ecc167ea9bc5a857211}{BindVertexBuffer}}(model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_ae71e7cb40f766ce9b5490b22971174ac}{GetVertexBuffer}}());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00214}00214             previousVertexBuffer = model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_ae71e7cb40f766ce9b5490b22971174ac}{GetVertexBuffer}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00215}00215         \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00216}00216         \textcolor{keywordflow}{if} (previousIndexBuffer != model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a7c1aaf201341a6e0666998cb7b13d98e}{GetIndexBuffer}}()) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00217}00217             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a12d4cae3d3f616dcc3a4b827a8abb5d5}{BindIndexBuffer}}(model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a7c1aaf201341a6e0666998cb7b13d98e}{GetIndexBuffer}}());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00218}00218             previousIndexBuffer = model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a7c1aaf201341a6e0666998cb7b13d98e}{GetIndexBuffer}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00219}00219         \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00220}00220 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00221}00221         \textcolor{keywordflow}{if} (modelType == ModelType::ANIMATED\_MODEL)}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00222}00222             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aebccacb95627e6c8c9da33367ca14368}{BindMaterialSlot}}(model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a00630e4f7a8e059586932b395e8f1f2b}{GetAnimator}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_animator_a0e7388a40a856c0a9388c07d5b81900f}{GetMaterialInstance}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_instance_a0cc12aae6dc313b4c4f24abe461b5f04}{GetSlot}}(\textcolor{stringliteral}{"{}animation"{}}));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00223}00223 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00224}00224         \textcolor{keywordflow}{for} (\mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} i = 0; i < model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a480cf3e35730e8fb88c1e40cef76fdea}{GetMeshes}}().GetSize(); i++) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00225}00225             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aebccacb95627e6c8c9da33367ca14368}{BindMaterialSlot}}(model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_ad9162b7e1cb7978be75adda96e17ab79}{GetMeshMaterialInstance}}(i)-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_instance_a0cc12aae6dc313b4c4f24abe461b5f04}{GetSlot}}(\textcolor{stringliteral}{"{}texture"{}}));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00226}00226 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00227}00227             \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_vector4__t}{Vector4f}} materialInfo \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00228}00228                 model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_abde872df60b377efa267618057c5bfe4}{GetMetadata}}().\mbox{\hyperlink{struct_o_s_k_1_1_a_s_s_e_t_s_1_1_model_metadata_a990f8bc4bc4c8c91586a992b79b8f582}{meshesMetadata}}[i].metallicFactor,}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00229}00229                 model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_abde872df60b377efa267618057c5bfe4}{GetMetadata}}().\mbox{\hyperlink{struct_o_s_k_1_1_a_s_s_e_t_s_1_1_model_metadata_a990f8bc4bc4c8c91586a992b79b8f582}{meshesMetadata}}[i].roughnessFactor,}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00230}00230                 0.0f,}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00231}00231                 0.0f}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00232}00232             \};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00233}00233             \textcolor{keyword}{struct }\{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00234}00234                 glm::mat4 model;}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00235}00235                 glm::mat4 transposedInverseModel;}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00236}00236                 \mbox{\hyperlink{class_o_s_k_1_1_vector4__t}{Vector4f}} materialInfo;}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00237}00237             \} modelConsts\{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00238}00238                 .model = transform.GetAsMatrix(),}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00239}00239                 .transposedInverseModel = glm::transpose(glm::inverse(transform.GetAsMatrix())),}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00240}00240                 .materialInfo = materialInfo}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00241}00241             \};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00242}00242             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aa78c754b21eb1cf45f2c05e36bdb9276}{PushMaterialConstants}}(\textcolor{stringliteral}{"{}model"{}}, modelConsts);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00243}00243 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00244}00244             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a359d8435654ddea9fdcc77d8cca9ff30}{DrawSingleMesh}}(model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a480cf3e35730e8fb88c1e40cef76fdea}{GetMeshes}}()[i].GetFirstIndexId(), model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a480cf3e35730e8fb88c1e40cef76fdea}{GetMeshes}}()[i].GetNumberOfIndices());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00245}00245         \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00246}00246     \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00247}00247 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00248}00248 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00249}00249 \textcolor{keywordtype}{void} PbrDeferredRenderSystem::ShadowsRenderLoop(\mbox{\hyperlink{namespace_o_s_k_1_1_a_s_s_e_t_s_a192866f841033401ce3c83efcaf81027}{ModelType}} modelType, \mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list}{ICommandList}}* commandList, \mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} cascadeIndex) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00250}00250     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \mbox{\hyperlink{namespace_o_s_k_1_1_e_c_s_a23d62d7bd6a58fd7f758079d87df6c71}{GameObjectIndex}} obj : \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_system_ad3611590e6bde825b973c160d7a867d9}{GetObjects}}()) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00251}00251         \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d}{ModelComponent3D}}\& model = \mbox{\hyperlink{class_o_s_k_1_1_engine_a17fd2842c078b7ddb4aaa70cd04549ab}{Engine::GetEntityComponentSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_entity_component_system_ab543c5c91b9b319ed21a01da96ea06d9}{GetComponent}}<\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d}{ModelComponent3D}}>(obj);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00252}00252         \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_transform3_d}{Transform3D}}\& transform = \mbox{\hyperlink{class_o_s_k_1_1_engine_a17fd2842c078b7ddb4aaa70cd04549ab}{Engine::GetEntityComponentSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_entity_component_system_ab543c5c91b9b319ed21a01da96ea06d9}{GetComponent}}<\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_transform3_d}{Transform3D}}>(obj);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00253}00253 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00254}00254         \textcolor{keywordflow}{if} (model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a29273ffaa49b5726cf7b942268a93e84}{GetType}}() != modelType)}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00255}00255             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00256}00256 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00257}00257         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a5e41e7a449345ecc167ea9bc5a857211}{BindVertexBuffer}}(model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_ae71e7cb40f766ce9b5490b22971174ac}{GetVertexBuffer}}());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00258}00258         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a12d4cae3d3f616dcc3a4b827a8abb5d5}{BindIndexBuffer}}(model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a7c1aaf201341a6e0666998cb7b13d98e}{GetIndexBuffer}}());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00259}00259 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00260}00260         \textcolor{keywordflow}{if} (modelType == ModelType::ANIMATED\_MODEL)}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00261}00261             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aebccacb95627e6c8c9da33367ca14368}{BindMaterialSlot}}(model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a00630e4f7a8e059586932b395e8f1f2b}{GetAnimator}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_animator_a0e7388a40a856c0a9388c07d5b81900f}{GetMaterialInstance}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_material_instance_a0cc12aae6dc313b4c4f24abe461b5f04}{GetSlot}}(\textcolor{stringliteral}{"{}animation"{}}));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00262}00262 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00263}00263         \textcolor{keyword}{struct }\{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00264}00264             glm::mat4 model;}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00265}00265             \textcolor{keywordtype}{int} cascadeIndex;}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00266}00266         \} \textcolor{keyword}{const} pushConstant\{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00267}00267             .model = transform.GetAsMatrix(),}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00268}00268             .cascadeIndex = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(cascadeIndex)}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00269}00269         \};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00270}00270         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aa78c754b21eb1cf45f2c05e36bdb9276}{PushMaterialConstants}}(\textcolor{stringliteral}{"{}model"{}}, pushConstant);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00271}00271 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00272}00272         \textcolor{keywordflow}{for} (\mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} i = 0; i < model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a480cf3e35730e8fb88c1e40cef76fdea}{GetMeshes}}().GetSize(); i++)}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00273}00273             commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a359d8435654ddea9fdcc77d8cca9ff30}{DrawSingleMesh}}(model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a480cf3e35730e8fb88c1e40cef76fdea}{GetMeshes}}()[i].GetFirstIndexId(), model.\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d_afba134f6e97739aaf47a74c3b4ba6690}{GetModel}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a480cf3e35730e8fb88c1e40cef76fdea}{GetMeshes}}()[i].GetNumberOfIndices());}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00274}00274     \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00275}00275 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00276}00276 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00277}00277 \textcolor{keywordtype}{void} PbrDeferredRenderSystem::RenderGBuffer(\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list}{ICommandList}}* commandList) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00278}00278     \textcolor{keyword}{const} \mbox{\hyperlink{_o_s_kmacros_8h_a1acaf9dff8b00604e55d38b35a744a9a}{TSize}} currentFrameIndex = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_a4a779e3af14025ec16d8a0c0a6cf0fe5}{GetCurrentCommandListIndex}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00279}00279     }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00280}00280     \textcolor{comment}{// SincronizaciÃ³n con todos los targets de color sobre los que vamos a escribir.}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00281}00281     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} targetImage : gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_a05a99fdb142018512bc2a466b8b3c705}{GetTargetImages}}(currentFrameIndex))}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00282}00282         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a4f744548e824c36b684f4d35bd1b90b2}{SetGpuImageBarrier}}(targetImage, GpuImageLayout::SHADER\_READ\_ONLY,}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00283}00283             \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::FRAGMENT\_SHADER, GpuBarrierAccessStage::SHADER\_READ), \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::COLOR\_ATTACHMENT\_OUTPUT, GpuBarrierAccessStage::COLOR\_ATTACHMENT\_WRITE),}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00284}00284             \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_barrier_info}{GpuImageBarrierInfo}}\{ .\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_barrier_info_a89f637c4de7944fc1228348171b23830}{baseLayer}} = 0, .numLayers = \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_a180d96d3f745a60bce6b0ffd5209ce35}{ALL\_IMAGE\_LAYERS}}, .baseMipLevel = 0, .numMipLevels = \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_af4ec621c557d492c7de3493e2b2bd1a9}{ALL\_MIP\_LEVELS}} \});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00285}00285 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00286}00286 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00287}00287     commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_ae3d1fda12c227f4b1782a16c2dca7f5c}{BeginGraphicsRenderpass}}(\&gBuffer, \mbox{\hyperlink{class_o_s_k_1_1_color_a59c0bb4e7d3b7d396f97e1119f01f1ca}{Color::BLACK}}() * 0.0f);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00288}00288     \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_render_system_ae3c3f809429c0eb238b4b5a58e4a756a}{SetupViewport}}(commandList);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00289}00289     commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aced1453da2f79b5e435df27c330ab8d1}{BindMaterial}}(gbufferMaterial);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00290}00290     commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aebccacb95627e6c8c9da33367ca14368}{BindMaterialSlot}}(globalGbufferMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}}));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00291}00291 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00292}00292     GBufferRenderLoop(commandList, ModelType::STATIC\_MESH);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00293}00293     GBufferRenderLoop(commandList, ModelType::ANIMATED\_MODEL);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00294}00294 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00295}00295     commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a27c970b0c75c78d08fa173eb3b875eb1}{EndGraphicsRenderpass}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00296}00296 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00297}00297     \textcolor{comment}{// SincronizaciÃ³n con todos los targets de color sobre los que vamos a leer en la fase resolve.}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00298}00298     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} targetImage : gBuffer.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_a05a99fdb142018512bc2a466b8b3c705}{GetTargetImages}}(currentFrameIndex))}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00299}00299         commandList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a4f744548e824c36b684f4d35bd1b90b2}{SetGpuImageBarrier}}(targetImage, GpuImageLayout::SHADER\_READ\_ONLY,}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00300}00300             \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::COLOR\_ATTACHMENT\_OUTPUT, GpuBarrierAccessStage::COLOR\_ATTACHMENT\_WRITE), \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::FRAGMENT\_SHADER, GpuBarrierAccessStage::SHADER\_READ),}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00301}00301             \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_barrier_info}{GpuImageBarrierInfo}}\{ .\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_image_barrier_info_a89f637c4de7944fc1228348171b23830}{baseLayer}} = 0, .numLayers = \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_a180d96d3f745a60bce6b0ffd5209ce35}{ALL\_IMAGE\_LAYERS}}, .baseMipLevel = 0, .numMipLevels = \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_af4ec621c557d492c7de3493e2b2bd1a9}{ALL\_MIP\_LEVELS}} \});}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00302}00302 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00303}00303 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00304}00304 \textcolor{keywordtype}{void} PbrDeferredRenderSystem::Resolve(\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list}{ICommandList}}* cmdList) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00305}00305     cmdList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_ae3d1fda12c227f4b1782a16c2dca7f5c}{BeginGraphicsRenderpass}}(\&\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_render_system_a8e9d568865c3d41fbec6afd49acb3cfa}{renderTarget}}, \mbox{\hyperlink{class_o_s_k_1_1_color_a59c0bb4e7d3b7d396f97e1119f01f1ca}{Color::BLACK}}() * 0.0f);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00306}00306     \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_render_system_ae3c3f809429c0eb238b4b5a58e4a756a}{SetupViewport}}(cmdList);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00307}00307 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00308}00308     cmdList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a5e41e7a449345ecc167ea9bc5a857211}{BindVertexBuffer}}(Sprite::globalVertexBuffer);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00309}00309     cmdList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a12d4cae3d3f616dcc3a4b827a8abb5d5}{BindIndexBuffer}}(Sprite::globalIndexBuffer);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00310}00310 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00311}00311     cmdList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aced1453da2f79b5e435df27c330ab8d1}{BindMaterial}}(resolveMaterial);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00312}00312     cmdList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aebccacb95627e6c8c9da33367ca14368}{BindMaterialSlot}}(resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}global"{}}));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00313}00313     cmdList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aebccacb95627e6c8c9da33367ca14368}{BindMaterialSlot}}(resolveMaterialInstance-\/>GetSlot(\textcolor{stringliteral}{"{}gbuffer"{}}));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00314}00314 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00315}00315     \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_push_const2_d}{PushConst2D}} pushConstants\{\};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00316}00316     pushConstants.\mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_push_const2_d_a3b53e9db4becde588f1bf7e3ac32d614}{color}} = \mbox{\hyperlink{class_o_s_k_1_1_color_ad2607662b668be5c5e3dd8b225bdb3f1}{Color::WHITE}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00317}00317     pushConstants.matrix = \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_render_system_a8e9d568865c3d41fbec6afd49acb3cfa}{renderTarget}}.\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_render_target_a290108ff189978eda525ed0ce953ad22}{GetSpriteTransform}}().\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_transform2_d_a669799b8f24dcf098f19691e5f364c8d}{GetAsMatrix}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00318}00318     pushConstants.texCoords = \{ -\/1.0f, -\/1.0f, 1.0f, 1.0f \};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00319}00319     cmdList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_aa78c754b21eb1cf45f2c05e36bdb9276}{PushMaterialConstants}}(\textcolor{stringliteral}{"{}sprite"{}}, pushConstants);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00320}00320 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00321}00321     cmdList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_ae3aa0f9da7dcfb03843196c7036c0209}{DrawSingleInstance}}(6);}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00322}00322 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00323}00323     cmdList-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_command_list_a27c970b0c75c78d08fa173eb3b875eb1}{EndGraphicsRenderpass}}();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00324}00324 \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00325}00325 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00326}\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_a6d1959599b80933c42431525efd4c12f}{00326}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_pbr_deferred_render_system_a6d1959599b80933c42431525efd4c12f}{PbrDeferredRenderSystem::OnTick}}(\mbox{\hyperlink{_o_s_kmacros_8h_ad05d5eacc527d5b61240124daf13b33b}{TDeltaTime}} deltaTime) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00327}00327     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \mbox{\hyperlink{namespace_o_s_k_1_1_e_c_s_a23d62d7bd6a58fd7f758079d87df6c71}{GameObjectIndex}} obj : \mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_i_system_ad3611590e6bde825b973c160d7a867d9}{GetObjects}}()) \{}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00328}00328         \mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d}{Model3D}}* model = \mbox{\hyperlink{class_o_s_k_1_1_engine_a17fd2842c078b7ddb4aaa70cd04549ab}{Engine::GetEntityComponentSystem}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_entity_component_system_ab543c5c91b9b319ed21a01da96ea06d9}{GetComponent}}<\mbox{\hyperlink{class_o_s_k_1_1_e_c_s_1_1_model_component3_d}{ModelComponent3D}}>(obj).GetModel();}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00329}00329 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00330}00330         \textcolor{keywordflow}{if} (model-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a29273ffaa49b5726cf7b942268a93e84}{GetType}}() == ModelType::STATIC\_MESH)}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00331}00331             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00332}00332 }
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00333}00333         model-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_model3_d_a00630e4f7a8e059586932b395e8f1f2b}{GetAnimator}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_animator_a86dd1eb6f3267c766efd02c617a7afcb}{Update}}(deltaTime, \mbox{\hyperlink{namespace_o_s_k_a5e479af2ede269150542d90384ce3ee2}{Vector3f}}(1.0f));}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00334}00334     \}}
\DoxyCodeLine{\Hypertarget{_pbr_deferred_render_system_8cpp_source_l00335}00335 \}}

\end{DoxyCode}
