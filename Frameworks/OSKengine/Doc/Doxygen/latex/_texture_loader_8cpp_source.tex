\hypertarget{_texture_loader_8cpp_source}{}\doxysection{Texture\+Loader.\+cpp}
\label{_texture_loader_8cpp_source}\index{OSKengine2/TextureLoader.cpp@{OSKengine2/TextureLoader.cpp}}
\mbox{\hyperlink{_texture_loader_8cpp}{Ir a la documentaci칩n de este archivo.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_texture_loader_8h}{TextureLoader.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00003}00003 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_texture_8h}{Texture.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00004}00004 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_o_s_kengine_8h}{OSKengine.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00005}00005 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_i_renderer_8h}{IRenderer.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00006}00006 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_i_gpu_memory_allocator_8h}{IGpuMemoryAllocator.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00007}00007 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_format_8h}{Format.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00008}00008 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_gpu_memory_types_8h}{GpuMemoryTypes.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00009}00009 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_i_gpu_data_buffer_8h}{IGpuDataBuffer.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00010}00010 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_i_command_list_8h}{ICommandList.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00011}00011 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_file_i_o_8h}{FileIO.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00012}00012 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_gpu_image_layout_8h}{GpuImageLayout.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00013}00013 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_render_api_type_8h}{RenderApiType.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00014}00014 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_gpu_image_usage_8h}{GpuImageUsage.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00015}00015 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_gpu_image_dimensions_8h}{GpuImageDimensions.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00017}00017 \textcolor{comment}{// \#define STB\_IMAGE\_IMPLEMENTATION <-\/ est치 en tiny\_glft.h}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00018}00018 \textcolor{preprocessor}{\#include <stbi\_image.h>}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00019}00019 \textcolor{preprocessor}{\#include <json.hpp>}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00021}00021 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespace_o_s_k_1_1_a_s_s_e_t_s}{OSK::ASSETS}};}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00022}00022 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s}{OSK::GRAPHICS}};}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00024}\mbox{\hyperlink{_texture_loader_8cpp_a61839499f35e15ae79d71c542eacc56a}{00024}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{_texture_loader_8cpp_a61839499f35e15ae79d71c542eacc56a}{HasRgbFormat}}(\mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_a3057691f190dabf7642cfde72cf2430f}{OSK::GRAPHICS::RenderApiType}} api) \{}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00025}00025     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00026}00026 \}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00028}\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_texture_loader_a64796c79bab29f0c01f547501e1a87c9}{00028}} \textcolor{keywordtype}{void} TextureLoader::Load(\textcolor{keyword}{const} std::string\& assetFilePath, \mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_i_asset}{IAsset}}** asset) \{}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00029}00029     \mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_texture}{Texture}}* output = (\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_texture}{Texture}}*)*asset;}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00031}00031     \textcolor{comment}{// Asset file.}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00032}00032     nlohmann::json assetInfo = nlohmann::json::parse(\mbox{\hyperlink{class_o_s_k_1_1_i_o_1_1_file_i_o_aad968707ec7b00bce0540c804f476dc9}{IO::FileIO::ReadFromFile}}(assetFilePath));}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00034}00034     \mbox{\hyperlink{_assert_8h_adfbccaec84df99b8277f9d877554170c}{OSK\_ASSERT}}(assetInfo.contains(\textcolor{stringliteral}{"{}file\_type"{}}), \textcolor{stringliteral}{"{}Archivo de textura incorrecto: no se encuentra 'file\_type'."{}});}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00035}00035     \mbox{\hyperlink{_assert_8h_adfbccaec84df99b8277f9d877554170c}{OSK\_ASSERT}}(assetInfo.contains(\textcolor{stringliteral}{"{}spec\_ver"{}}), \textcolor{stringliteral}{"{}Archivo de textura incorrecto: no se encuentra 'spec\_ver'."{}});}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00036}00036     \mbox{\hyperlink{_assert_8h_adfbccaec84df99b8277f9d877554170c}{OSK\_ASSERT}}(assetInfo.contains(\textcolor{stringliteral}{"{}name"{}}), \textcolor{stringliteral}{"{}Archivo de textura incorrecto: no se encuentra 'name'."{}});}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00037}00037     \mbox{\hyperlink{_assert_8h_adfbccaec84df99b8277f9d877554170c}{OSK\_ASSERT}}(assetInfo.contains(\textcolor{stringliteral}{"{}asset\_type"{}}), \textcolor{stringliteral}{"{}Archivo de textura incorrecto: no se encuentra 'asset\_type'."{}});}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00038}00038     \mbox{\hyperlink{_assert_8h_adfbccaec84df99b8277f9d877554170c}{OSK\_ASSERT}}(assetInfo.contains(\textcolor{stringliteral}{"{}raw\_asset\_path"{}}), \textcolor{stringliteral}{"{}Archivo de textura incorrecto: no se encuentra 'raw\_asset\_path'."{}});}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00039}00039 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00040}00040     std::string texturePath = assetInfo[\textcolor{stringliteral}{"{}raw\_asset\_path"{}}];}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00041}00041     output-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_i_asset_af0bbd1c59b2cd81667b63cb6d015c11c}{SetName}}(assetInfo[\textcolor{stringliteral}{"{}name"{}}]);}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00042}00042 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00043}00043     \textcolor{comment}{// Texture.}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00045}00045     \textcolor{keywordtype}{int} width = 0;}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00046}00046     \textcolor{keywordtype}{int} height = 0;}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00047}00047     \textcolor{keywordtype}{int} numChannels = 0;}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00048}00048     stbi\_info(texturePath.c\_str(), \&width, \&height, \&numChannels);}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00049}00049 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00050}00050     \textcolor{comment}{// Las gr치ficas no soportan im치genes de 24 bits de manera nativa.}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00051}00051     \textcolor{keywordflow}{if} (numChannels != 4 \&\& !\mbox{\hyperlink{_texture_loader_8cpp_a61839499f35e15ae79d71c542eacc56a}{HasRgbFormat}}(\mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>GetRenderApi()))}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00052}00052         numChannels = 4;}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00053}00053 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00054}00054     stbi\_uc* pixels = stbi\_load(texturePath.c\_str(), \&width, \&height, \textcolor{keyword}{nullptr}, numChannels);}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00055}00055 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00056}00056     output-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_texture_a5b8b6744153b2fb25dfef0b8e20ba970}{\_SetSize}}(\mbox{\hyperlink{namespace_o_s_k_a29c2aa145248042c8045d1329efa4770}{Vector2ui}}(width, height));}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00057}00057     output-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_texture_ad052ebbde1bef14f74b8217bc790b77f}{\_SetNumberOfChannels}}(numChannels);}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00058}00058 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00059}00059     \textcolor{keyword}{const} \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_aac59f9d056e083c0b49ea768f974e3e8}{GRAPHICS::Format}} imageFormat = assetInfo.contains(\textcolor{stringliteral}{"{}is\_hdr"{}}) \&\& assetInfo[\textcolor{stringliteral}{"{}is\_hdr"{}}] == \textcolor{stringliteral}{"{}true"{}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00060}00060         ? \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_aac59f9d056e083c0b49ea768f974e3e8ab90166b94483824b0f67dbb9ae2feef3}{GRAPHICS::Format::RGBA32\_SFLOAT}}}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00061}00061         : \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_aac59f9d056e083c0b49ea768f974e3e8ae5a76309919d3c679c642c13125eb930}{GRAPHICS::Format::RGBA8\_SRGB}};}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00063}00063     \textcolor{keyword}{const} \mbox{\hyperlink{class_o_s_k_1_1_vector3__t}{Vector3ui}} size(width, height, 1);}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00064}00064     \textcolor{keyword}{auto} image = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_acf03703bbb6f031f905612d86f104b38}{GetMemoryAllocator}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_gpu_memory_allocator_a9edc56722522b79a352ce378e1ac8595}{CreateImage}}(size, \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_ab91ccc08d13454cfeb3c4f78deb72d59a096d0d67e4521bdc9ae95ad5ba97c596}{GRAPHICS::GpuImageDimension::d2D}}, 1, imageFormat, \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_a19a2f70fc994c00eb022e520608c5ffaa5d0791856a3081df75c6093017a61a36}{GRAPHICS::GpuImageUsage::SAMPLED}} | \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_a19a2f70fc994c00eb022e520608c5ffaafb3bb8503e5cd907a3a7b02a495c229e}{GRAPHICS::GpuImageUsage::TRANSFER\_SOURCE}} | \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_a19a2f70fc994c00eb022e520608c5ffaac61dfc60317a58b2843ec29f8e3c2359}{GRAPHICS::GpuImageUsage::TRANSFER\_DESTINATION}}, \mbox{\hyperlink{namespace_o_s_k_1_1_g_r_a_p_h_i_c_s_a85a830e82585f3a565d1f097491042cea95c8166e4f408834884bbe57fef928f6}{GRAPHICS::GpuSharedMemoryType::GPU\_ONLY}}, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00066}00066     \mbox{\hyperlink{class_o_s_k_1_1_owned_ptr}{OwnedPtr<ICommandList>}} uploadCmdList = \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_a0fa1cd26067c520e90cfa647f66e8366}{CreateSingleUseCommandList}}();}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00067}00067     uploadCmdList-\/>Reset();}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00068}00068     uploadCmdList-\/>Start();}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00070}00070     uploadCmdList-\/>SetGpuImageBarrier(image.GetPointer(), GpuImageLayout::UNDEFINED, GpuImageLayout::TRANSFER\_DESTINATION,}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00071}00071         \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::DEFAULT, GpuBarrierAccessStage::DEFAULT), \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::TRANSFER, GpuBarrierAccessStage::TRANSFER\_WRITE));}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00072}00072     \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_a84c879978d05eb6e5ac7828dd115ab5d}{UploadImageToGpu}}(image.GetPointer(), pixels, image-\/>GetNumberOfBytes(), uploadCmdList.\mbox{\hyperlink{class_o_s_k_1_1_owned_ptr_a81dfab2299056fc9858aace55fca0042}{GetPointer}}());}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00073}00073     uploadCmdList-\/>SetGpuImageBarrier(image.GetPointer(), GpuImageLayout::TRANSFER\_DESTINATION, GpuImageLayout::SHADER\_READ\_ONLY,}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00074}00074         \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::TRANSFER, GpuBarrierAccessStage::TRANSFER\_WRITE), \mbox{\hyperlink{struct_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_gpu_barrier_info}{GpuBarrierInfo}}(GpuBarrierStage::FRAGMENT\_SHADER, GpuBarrierAccessStage::SHADER\_READ));}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00075}00075 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00076}00076     uploadCmdList-\/>Close();}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00077}00077     \mbox{\hyperlink{class_o_s_k_1_1_engine_a019c5397d042224c134b7fd22c739d00}{Engine::GetRenderer}}()-\/>\mbox{\hyperlink{class_o_s_k_1_1_g_r_a_p_h_i_c_s_1_1_i_renderer_af337a6b45b1e298a4edff91981586d14}{SubmitSingleUseCommandList}}(uploadCmdList.\mbox{\hyperlink{class_o_s_k_1_1_owned_ptr_a81dfab2299056fc9858aace55fca0042}{GetPointer}}());}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00078}00078 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00079}00079     stbi\_image\_free(pixels);}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00080}00080 }
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00081}00081     output-\/>\mbox{\hyperlink{class_o_s_k_1_1_a_s_s_e_t_s_1_1_texture_ac48b769e17329079b1348a7b7dab4e4c}{\_SetImage}}(image);}
\DoxyCodeLine{\Hypertarget{_texture_loader_8cpp_source_l00082}00082 \}}

\end{DoxyCode}
